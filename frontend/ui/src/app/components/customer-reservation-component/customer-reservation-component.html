<div class="p-4">
  <h2 class="text-2xl font-bold mb-4">Customer role - testing for reservation</h2>

  <button class="bg-blue-500 text-white px-4 py-2 rounded mb-4" (click)="showForm = true">新增预约</button>

  <!-- 预约列表 -->
  <ul class="space-y-2">
    <li *ngFor="let r of reservations" class="border p-3 rounded flex justify-between items-center" [class.opacity-60]="r.status === 'canceled'" class="margin-top-bottom">
      <div>
        <span>姓名 : </span>
        <span>{{ r.customerName }}</span>
      </div>

      <div>
        <span>Phone: </span>
        <span>{{ r.phone }}</span>
      </div>

      <div>
        <span>日期: </span>
        <span>{{ r.date | date:'yyyy-MM-dd' }}</span>
      </div>

      <div>
        <span>时间: </span>
        <span>{{ r.timeSlot }}</span>
      </div>

      <div>
        <span>人数: </span>
        <span>{{ r.partySize }}</span>
      </div>

      <div>
        <span>备注: </span>
        <span>{{ r.notes }}</span>
      </div>

      <div>
        <span>状态：</span>
        <span>{{ r.status === 'active' ? '已预约' : '已取消' }}</span>          
      </div>

      <button *ngIf="r.status === 'active'" class="bg-red-500 text-white px-3 py-1 rounded" (click)="cancelReservation(r._id!)">取消预约</button>
    </li>
  </ul>

  <!-- 新增预约弹窗 -->
  <div *ngIf="showForm" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-white p-6 rounded-lg w-96">
      <h3 class="text-xl font-bold mb-4">新增预约</h3>
      <form (ngSubmit)="addReservation()">
        <div class="mb-2" class="margin-top-bottom">
          <label class="block">姓名</label>
          <input [(ngModel)]="newReservation.customerName" name="customerName" required
            class="border w-full p-2 rounded" />
        </div>
        <div class="mb-2" class="margin-top-bottom">
          <label class="block">电话</label>
          <input [(ngModel)]="newReservation.phone" name="phone" required class="border w-full p-2 rounded" />
        </div>
        <div class="mb-2" class="margin-top-bottom">
          <label class="block">邮箱</label>
          <input [(ngModel)]="newReservation.email" name="email" type="email" class="border w-full p-2 rounded" />
        </div>
        <div class="mb-2" class="margin-top-bottom">
          <label class="block">日期</label>
          <input [(ngModel)]="newReservation.date" name="date" type="date" required class="border w-full p-2 rounded" />
        </div>
        <div class="mb-2" class="margin-top-bottom">
          <label class="block">时间段</label>
          <select [(ngModel)]="newReservation.timeSlot" name="timeSlot" required class="border w-full p-2 rounded">
            <option value="" disabled selected>请选择时间段</option>
            <option *ngFor="let slot of timeSlots" [value]="slot">{{ slot }}</option>
          </select>
        </div>
        <div class="mb-2" class="margin-top-bottom">
          <label class="block">人数</label>
          <input [(ngModel)]="newReservation.partySize" name="partySize" type="number" required min="1"
            class="border w-full p-2 rounded" />
        </div>
        <div class="mb-2" class="margin-top-bottom">
          <label class="block">备注</label>
          <textarea [(ngModel)]="newReservation.notes" name="notes" class="border w-full p-2 rounded"></textarea>
        </div>

        <div class="flex justify-end space-x-2 mt-4" class="margin-top-bottom">
          <button type="button" class="px-4 py-2 border rounded" (click)="showForm = false">取消</button>
          <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">保存</button>
        </div>
      </form>
    </div>
  </div>
</div>